
// ACCORDING TO FIGMA DESIGN SECTION

// Main users table - stores core information about individuals and companies managing patients
Table users {
  id              int [pk, increment]
  first_name      varchar(100) [not null]
  last_name       varchar(100) [not null]
  middle_name     varchar(100) [null]
  date_of_birth   date [not null] // Age can be calculated from date_of_birth
  phone_number    varchar(20) [unique, not null] // Primary contact number
  phone_verified  boolean [default: false] // Whether phone number is verified
  email           varchar(255) [unique, not null] // Primary email
  gender          enum("male", "female", "other")
  hashed_password varchar(255) [null] // Null if user only uses OAuth
  wallet_id       int [null, ref: > user_wallets.id] // Reference to user's digital wallet
  referral_code   varchar [null] // Code used for referral program
  business_name   varchar(255) [null] // For business/company accounts
  legal_name      varchar(255) [null] // Legal business name if different
  failed_attempts int [default: 0] // Track failed login attempts for security
  is_locked       boolean [default: false] // Account gets locked after too many failed attempts
  created_at      timestamp [default: now()]
  updated_at      timestamp [default: now()]
  deleted_at      timestamp [null] // Soft delete support

  indexes {
    (first_name, last_name)
    email
    phone_number
    referral_code
  }
}

// Secondary email addresses for users
Table user_emails {
  id         int [pk, increment]
  user_id    int [not null, ref: > users.id]
  email      varchar(255) [unique, not null]
  is_primary boolean [default: false]
  verified   boolean [default: false]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    (user_id, email) [unique]
  }
}

// Phone verification codes
Table user_phone_verification_codes {
  id            int [pk, increment]
  user_id       int [not null, ref: > users.id]
  phone_number  varchar(20) [not null]
  code          varchar(6) [not null] // Verification code sent to user
  expires_at    timestamp [not null]
  attempts      int [default: 0] // Number of verification attempts
  verified      boolean [default: false]
  created_at    timestamp [default: now()]
  verified_at   timestamp [null]

  indexes {
    user_id
    phone_number
    code
    expires_at
  }
}

// Supported authentication methods/providers
Table auth_providers {
  id int [pk, increment]
  provider enum("email", "apple", "google", "facebook", "microsoft", "twitter", "linkedin", "github", "phone") [not null]
  display_name varchar(100) [not null] // Friendly name for display
  is_active boolean [default: true] // Allows disabling specific providers
  client_id varchar(255) [null] // OAuth client ID if applicable
  client_secret varchar(255) [null] // OAuth client secret if applicable 
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    provider [unique]
    is_active
  }
}

// Links users to their authentication methods
Table user_auth {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  provider_id int [not null, ref: > auth_providers.id]
  provider_uid varchar(255) [not null] // External provider's user ID
  email varchar(255) [null] // Email associated with this auth method
  access_token text [null] // OAuth access token
  refresh_token text [null] // OAuth refresh token
  token_expires_at timestamp [null]
  last_login_at timestamp [null]
  is_primary boolean [default: false] // Primary auth method for user
  metadata json [null] // Additional provider-specific data
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    (user_id, provider_id) [unique]
    provider_uid
    email
    is_primary
    last_login_at
  }
}

// Additional user information and preferences
// TODO: check with design and possible duplicates
Table user_profiles {
  id         int [pk, increment]
  user_id    int [not null, ref: > users.id]
  bio        text
  location   varchar(255)
  interests  text
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]
  deleted_at timestamp [null]

  indexes {
    user_id
  }
}



// Password reset management
Table password_resets {
  id            int [pk, increment]
  user_id       int [not null, ref: > users.id]
  reset_token   varchar(255) [not null]
  expires_at    timestamp [not null]
  created_at    timestamp [default: now()]
  used          boolean [default: false]
  ip_address    varchar(45) [not null]
  user_agent    text
  success       boolean [default: false]

  indexes {
    reset_token
    user_id
    expires_at
  }
}

// Security audit trail
Table security_logs {
  id            int [pk, increment] 
  user_id       int [not null, ref: > users.id]
  action        enum("failed_login", "successful_login", "password_reset_requested", "password_reset_completed", "account_locked", "account_unlocked", "mfa_enabled", "mfa_disabled", "suspicious_activity", "ip_change", "device_change", "password_changed", "email_changed", "profile_updated") [not null]
  ip_address    varchar(45) [not null]
  user_agent    text
  location      json [null] // City, country, coordinates
  device_info   json [null] // OS, browser, etc
  metadata      json [null]
  severity      enum("info", "warning", "critical") [not null]
  created_at    timestamp [default: now()]

  indexes {
    user_id
    action
    severity  
    created_at
    ip_address
  }
}

// Session management
Table user_sessions {
  id            int [pk, increment]
  user_id       int [not null, ref: > users.id]
  session_token varchar(255) [not null]
  ip_address    varchar(45) [not null]
  user_agent    text
  device_info   json [null]
  location      json [null]
  expires_at    timestamp [not null]
  created_at    timestamp [default: now()]
  last_activity timestamp [default: now()]
  ended_at      timestamp [null]
  end_reason    enum("expired", "logged_out", "session_invalidated") [null]

  indexes {
    session_token
    user_id
    expires_at
    ip_address
  }
}

// Device tracking for security
Table user_devices {
  id            int [pk, increment]
  user_id       int [not null, ref: > users.id]
  device_id     varchar(255) [not null]
  device_type   varchar(50) [not null]
  device_name   varchar(100)
  os            varchar(50)
  os_version    varchar(20)
  browser       varchar(50)
  browser_version varchar(20)
  is_trusted    boolean [default: false]
  is_active     boolean [default: true]
  last_used     timestamp
  last_ip       varchar(45)
  last_location json [null]
  created_at    timestamp [default: now()]
  deactivated_at timestamp [null]

  indexes {
    (user_id, device_id) [unique]
    is_active
    device_type
  }
}

// Login statistics
Table login_stats {
  id                int [pk, increment]
  user_id           int [not null, ref: > users.id]
  successful_logins int [default: 0]
  failed_attempts   int [default: 0]
  last_failed_at    timestamp [null]
  last_success_at   timestamp [null]
  password_resets   int [default: 0]
  suspicious_activities int [default: 0]
  created_at        timestamp [default: now()]
  updated_at        timestamp [default: now()]

  indexes {
    user_id
  }
}

// Platform usage statistics
Table platform_stats {
  id              int [pk, increment]
  platform        enum("web", "ios", "android") [not null]
  total_logins    int [default: 0]
  active_sessions int [default: 0]
  unique_users    int [default: 0]
  date            date [not null]
  
  indexes {
    (platform, date) [unique]
  }
}

// Geographic service availability tracking
Table service_regions {
  id int [pk, increment]
  country_code varchar(2) [not null, default: "CA"] // ISO country code
  province varchar(100) [not null] // Province/state name
  city varchar(255) [not null] // City name
  postal_code varchar(10) [not null] // Postal code in A1A 1A1 format
  region_type enum("urban", "suburban", "rural") [not null] // Type of region
  population int [null] // Approximate population served
  service_radius decimal(5,2) [null] // Service coverage radius in km
  is_active boolean [default: false] // Whether services are currently available
  activation_date date [null] // When service became available
  deactivation_date date [null] // When service was suspended/ended
  service_level enum("full", "limited", "planned") [not null, default: "planned"] // Service availability level
  hcw_coverage_target int [null] // Target number of healthcare workers needed
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    (country_code, province, city, postal_code) [unique]
    service_level
    is_active
  }
}

// Regional service demand tracking
Table service_region_demand {
  id int [pk, increment] 
  region_id int [not null, ref: > service_regions.id]
  demand_level enum("low", "medium", "high", "critical") [not null]
  waitlist_count int [default: 0] // Number of users waiting
  active_requests int [default: 0] // Number of active service requests
  last_assessment_date date [not null] // Last demand assessment date
  next_assessment_date date [not null] // Next scheduled assessment
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    region_id
    demand_level
    waitlist_count
  }
}

// Service availability waitlist
Table service_waitlist {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  region_id int [not null, ref: > service_regions.id]
  service_type varchar(100) [not null] // Specific service being requested
  urgency_level enum("low", "medium", "high") [not null]
  request_date timestamp [default: now()]
  preferred_start_date date [null]
  notification_status enum("pending", "notified", "contacted") [default: "pending"]
  last_notification_date timestamp [null]
  status enum("active", "fulfilled", "expired", "cancelled") [default: "active"]
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    (user_id, region_id, service_type) [unique]
    status
    urgency_level
  }
}

// Phone number verification system
Table user_phone_verifications {
  id                int [pk, increment]
  user_id           int [not null, ref: > users.id]
  phone_number      varchar(20) [not null]
  verification_code varchar(6) [not null] // SMS verification code
  is_verified       boolean [default: false]
  expires_at        timestamp [not null] // Code expiration time
  created_at        timestamp [default: now()]
  updated_at        timestamp [default: now()]
  
  Indexes {
    (user_id, phone_number) [unique] // One verification process per phone number
  }
}

// Customer support contact information
Table support_contacts {
  id            int [pk, increment]
  type          enum("phone", "email", "website", "live_chat", "social_media", "other") [not null]
  value         varchar(255) [not null] // contact info
  description   text [null] // Additional details
  is_active     boolean [default: true] // availability status
  created_at    timestamp [default: now()]
  updated_at    timestamp [default: now()]

  Indexes {
    (type, value) [unique] // Prevents duplicate contact methods
  }
}

// user address info
Table user_addresses {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  unit_no varchar(50) [null]
  street_address varchar(255) [not null]
  city varchar(100) [not null]
  province varchar(100) [not null]
  postal_code varchar(20) [not null]
  country varchar(100) [not null]
  created_at timestamp [not null]
  updated_at timestamp [not null]
}

// subscriptions info
Table subscriptions {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
  price decimal(10, 2) [not null]
  duration enum('monthly', 'yearly') [not null]
  created_at timestamp [not null]
  notes text [null] // any additional info
}

// user subscriptions historical info
Table user_subscriptions {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  subscription_id int [not null, ref: > subscriptions.id]
  start_date date [not null]
  end_date date [null]
  status enum('active', 'inactive', 'cancelled') [not null]
  created_at timestamp [not null]
}

// storing basic info like name, email, user managing patients treatments, age, dob, gender
// other notes, address, 
Table patients {
  id integer [pk, increment]
  user_id int [not null, ref: > users.id]
  email varchar(255) [unique, not null]
  first_name varchar(100) [not null]
  last_name varchar(100) [not null]
  middle_name varchar(100) [null]
  date_of_birth date [not null]
  gender enum("male", "female", "other") [not null]
  profile_picture varchar(255) [null]
  hashed_password varchar(255) [null]
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]
  deleted_at timestamp [null]

  indexes {
    user_id
    email
    (first_name, last_name)
    date_of_birth
  }
}

// Patient addresses
Table patients_addresses {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  unit_no varchar(50) [null]
  street_address varchar(255) [not null]
  city varchar(100) [not null]
  province varchar(100) [not null]
  postal_code varchar(20) [not null]
  country varchar(100) [not null]
  is_primary boolean [default: false]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    patient_id
    postal_code
    (city, province, country)
  }
}

// Patient contacts
Table patients_contacts {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  email_address varchar(255) [null]
  phone_number varchar(20) [null]
  is_primary boolean [default: false]
  contact_type enum("emergency", "family", "guardian", "other") [not null]
  relationship varchar(100) [null] // relationship to the user managing the patient
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    patient_id
    contact_type
    (email_address, phone_number)
  }
}

// Patient medications for the care plan
Table patients_medicines {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  medicine_id int [not null, ref: > medicines.id]
  care_plan_id int [not null, ref: > care_plans.id]
  assigned_by int [not null, ref: > users.id]
  recorded_at timestamp [not null]
  dosage varchar(100) [not null]
  frequency enum("daily", "weekly", "monthly", "as_needed") [not null]
  start_date date [not null]
  end_date date [null]
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    patient_id
    medicine_id
    care_plan_id
    frequency
    (start_date, end_date)
  }
}

// Patient personal interests
Table patients_personal_interests {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  interest_id int [not null, ref: > personal_interests.id]
  created_at timestamp [default: now()]
  assigned_by int [not null, ref: > users.id]
  notes text [null]
  indexes {
    (patient_id, interest_id)
  }
}

// Patient mobility challenges
Table patients_mobility_challenges {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  challenge_id int [not null, ref: > mobility_challenges.id]
  care_plan_id int [not null, ref: > care_plans.id]
  assigned_by int [not null, ref: > users.id]
  //severity enum("mild", "moderate", "severe") [not null]
  //recorded_at timestamp [not null]
  //recorded_by int [ref: >HealthcareWorkers.hcw_id]
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    patient_id
    challenge_id
    care_plan_id
    //severity
  }
}

// Patient perception communication issues
Table patients_perception_communication_issues {
  id int [pk, increment]
  issue_id int [not null, ref: > perception_communication_issues.id]
  patient_id int [not null, ref: > patients.id]
  assigned_by int [not null, ref: > users.id]
  care_plan_id int [not null, ref: > care_plans.id]
  //severity enum("mild", "moderate", "severe") [not null]
  //recorded_at timestamp [not null]
  //description text [null]
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    patient_id
    issue_id
    care_plan_id
  }
}

// Patient nutritional challenges
Table patients_nutritional_challenges {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  challenge_id int [not null, ref: > nutritional_challenges.id]
  care_plan_id int [not null, ref: > care_plans.id]
  assigned_by int [not null, ref: > users.id]
  //severity enum("mild", "moderate", "severe") [not null]
  //recorded_at timestamp [not null]
  //dietary_restrictions text [null]
  //recorded_by int [ref: > HealthcareWorkers.hcw_id]
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    patient_id
    challenge_id
    care_plan_id
    //severity
  }
}

// Patient moods
Table patients_moods {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  mood_id int [not null, ref: > moods.id]
  care_plan_id int [not null, ref: > care_plans.id]
  assigned_by int [not null, ref: > users.id]
  //intensity enum("low", "medium", "high") [not null]
  //recorded_at timestamp [not null]
  //recorded_by int [ref: > HealthcareWorkers.hcw_id]  assigned_by int [not null, ref: > users.id]
  notes text [null]
  created_at timestamp [default: now()]
updated_at timestamp [default: now()]
  indexes {
    patient_id
    mood_id
    care_plan_id
    //intensity
    //recorded_at
  }
}

// Patient health conditions
Table patients_health_conditions {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  condition_id int [not null, ref: > health_conditions.id]
  care_plan_id int [not null, ref: > care_plans.id]
  assigned_by int [not null, ref: > users.id]
  //severity enum("mild", "moderate", "severe") [not null]
  //onset_date date [null]
  //recorded_by int [ref: > HealthcareWorkers.hcw_id]
  //is_chronic boolean [default: false]
  //recorded_at timestamp [not null]
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    patient_id
    condition_id
    care_plan_id
    //severity
    //onset_date
  }
}

// Patient cognition
Table patients_cognition {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  cognition_id int [not null, ref: > cognition_states.id]
  care_plan_id int [not null, ref: > care_plans.id]
  assigned_by int [not null, ref: > users.id]
  severity enum("mild", "moderate", "severe") [not null]
  recorded_at timestamp [not null]
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    patient_id
    cognition_id
    care_plan_id
    //severity
    //recorded_at
  }
}

// Patient allergies
Table patients_allergies {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  allergy_id int [not null, ref: > allergies.id]
  care_plan_id int [not null, ref: > care_plans.id]
  //severity enum("mild", "moderate", "severe") [not null]
  //reaction_type text [null]
  assigned_by int [not null, ref: > users.id]
  //assigned_at timestamp [not null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    patient_id
    allergy_id
    care_plan_id
    //severity
  }
}

// Patient diagnoses
Table patients_diagnoses {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  diagnosis_id int [not null, ref: > diagnoses.id]
  care_plan_id int [not null, ref: > care_plans.id]
  //diagnosed_by varchar(255) [not null]
  //diagnosis_date date [not null]
  assigned_by int [not null, ref: > users.id]
  //assigned_at timestamp [not null]
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    patient_id
    diagnosis_id
    care_plan_id
    //diagnosis_date
  }
}

// terms used for medicine
Table medicines {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
}

// personal interests terms
Table personal_interests {
  id int [pk, increment]
  name varchar [unique, not null]
  description text [null]
}

Table healthcare_workers_personal_interests {
  id int [pk, increment]
  hcw_id int [not null, ref: > healthcare_workers.id]
  interest_id int [not null, ref: > personal_interests.id]
}

// table for holding terms for mobility challenges care is provided for
Table mobility_challenges {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
}

// info about mobility challenges managed by a user or company possible marketing purposes later
Table user_managed_mobility_challenges {
  id int [pk, increment]
  mobilitychallenges_id int [not null, ref: > mobility_challenges.id]
  user_id int [not null, ref: > users.id]
  assigned_at timestamp [not null]
  description text [null]
}

// perception communication issues a vocabulary for holding info about care activities
Table perception_communication_issues {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
}

// perception communication issues recorded for a patient
Table patients_perception_communication_issues {
  id int [pk, increment]
  preceptioncommunicationissues_id int [not null, ref: > perception_communication_issues.id]
  patient_id int [not null, ref: > patients.id]
  assigned_by int [not null, ref: > users.id]
  careplan_id int [not null, ref: > care_plans.id]
  //recorded_by int [ref: > HealthcareWorkers.hcw_id]
  recorded_at timestamp [not null]
  description text [null]
}

// info about perception communication issues managed by a user or company possible marketing purposes later
Table user_managed_perception_communication_issues {
  id int [pk, increment]
  preceptioncommunicationissues_id int [not null, ref: > perception_communication_issues.id]
  user_id int [not null, ref: > users.id]
  assigned_at timestamp [not null]
  description text [null]
}

// holding info for terms for nutritional challenges
Table nutritional_challenges {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  notes text [null]
}

// info about nutritional challenges managed by a user or company possible marketing purposes later
Table user_managed_nutritional_challenges {
  id int [pk, increment]
  nutritionalchallenges_id int [not null, ref: > nutritional_challenges.id]
  user_id int [not null, ref: > users.id]
  assigned_at timestamp [not null]
  notes text [null]
}

// mood states terms info
Table moods {
  id int [pk, increment]
  name varchar(100) [unique]
  description text [null]
}

// info about patient moods states managed by a user or company possible marketing purposes later
Table user_managed_moods {
  id int [pk, increment]
  mood_id int [not null, ref: > moods.id]
  user_id int [not null, ref: > users.id]
  assigned_at timestamp [not null]
  notes text [null]
}

// info about health conditions terms for care
Table health_conditions {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
}

// info about health conditions managed by a user or company possible marketing purposes later
Table user_managed_health_conditions {
  id int [pk, increment]
  healthconditions_id int [not null, ref: > health_conditions.id]
  user_id int [not null, ref: > users.id]
  started_at date [not null]
  assigned_at timestamp [not null]
}

// terms for cognition states
Table cognition_states {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
}

// terms for allergies 
Table allergies {
  id int [pk, increment]
  name varchar(200) [unique, not null]
  description text [null]
}

// diagnosis terms and conditions info
Table diagnoses {
  id int [pk, increment]
  name varchar(200) [unique, not null]
  description text [null]
}

// types of property info
Table property_types {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
  created_at timestamp [not null]
}

// info about patients property types
Table patients_property_types {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  property_type_id int [not null, ref: > property_types.id]
  assigned_by int [not null, ref: > users.id]
  created_at timestamp [not null]
  notes text [null]
}

// info about property types managed by a user or company possible marketing purposes later
Table user_managed_property_types {
  id int [pk, increment]
  property_type_id int [not null, ref: > property_types.id]
  user_id int [not null, ref: > users.id]
  created_at timestamp [not null]
}

// different caresettings info
Table care_settings {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
  created_at timestamp [not null]
}

// info about patients care setting
Table patients_care_settings {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  care_setting_id int [not null, ref: > care_settings.id]
  assigned_by int [not null, ref: > users.id]
  assigned_at timestamp [not null]
}

// info about care settings managed by a user or company possible marketing purposes later
Table user_managed_care_settings {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  care_setting_id int [not null, ref: > care_settings.id]
  created_at timestamp [not null]
}

// care settings HCW preferrs working in
Table healthcare_workers_preferred_care_settings {
  id int [pk, increment]
  hcw_id int [not null, ref: > healthcare_workers.id]
  care_setting_id int [not null, ref: > care_settings.id]
  assigned_at timestamp [not null]
}

// types of jobs i.e. "employment", "independent contractor", "volunteer", "sponsorship"
Table job_types {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
  created_at timestamp [not null]
  updated_at timestamp [not null]
  deleted_at timestamp [null]
}

// job types preferrence for HCWs
Table healthcare_workers_preferred_jobs {
  id int [pk, increment]
  hcw_id int [not null, ref: > healthcare_workers.id]
  job_type_id int [not null, ref: > job_types.id]
  assigned_at timestamp [not null]
  updated_at timestamp [not null]
  deleted_at timestamp [null]
  notes text [null]
}



// Payment schedules
// consider transaction_date date [null]
// consdier naming change pay_period_frequency
Table payment_schedules {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  job_id int [not null, ref: > jobs.id]
  patient_id int [not null, ref: > patients.id]
  timezone varchar(50) [not null]
  date_format varchar(50) [not null]
  time_format varchar(50) [not null]
  calendar_start_day enum("monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday") [not null]
  frequency enum("weekly_52", "weekly_53", "biweekly_26", "biweekly_27", "semimonthly_24", "monthly_12") [not null]
  start_date date [not null]
  end_date date [null]
  next_payment_date date [not null]
  status enum("active", "paused", "completed", "cancelled") [not null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    (worker_id, job_id)
    patient_id
    frequency
    status
    next_payment_date
  }
}

// User wallets
Table users_wallets {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  balance decimal(10, 2) [not null]
  currency varchar(3) [not null, default: "CAD"]
  status enum("active", "frozen", "closed") [not null]
  last_updated timestamp [not null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    user_id
    status
  }
  //payment_methods enum('stripe')
  //paystubs varchar
  //expenses
  //invoice_id
}

// User invoices
Table users_invoices {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  patient_id int [not null, ref: > patients.id]
  invoice_number varchar(50) [unique, not null]
  period_start date [not null]
  period_end date [not null]
  total_amount decimal(10,2) [not null]
  tax_amount decimal(10,2) [not null]
  currency varchar(3) [not null, default: "CAD"]
  due_date date [not null]
  status enum("draft", "pending", "paid", "overdue", "cancelled") [not null]
  payment_method enum("credit_card", "debit_card", "bank_transfer", "wallet") [null]
  paid_at timestamp [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    user_id
    patient_id
    invoice_number
    status
    due_date
  }
}

// Invoice items
Table invoices_items {
  id int [pk, increment]
  schedule_id int [not null, ref: > care_schedules.id]
  hcw_id int [not null, ref: > healthcare_workers.id]
  period_start date [not null]
  period_end date [not null]
  total_hours decimal(5,2) [not null]
  total_pay decimal(10,2) [not null]
  generated_at timestamp [not null]
}

//Table UserPayment {
//  payment_id int [pk, increment]
//  invoice_id int [ref: > UserInvoice.invoice_id]
//  wallet_id int [ref: > UserWallet.wallet_id]
//  paymentschedule_id int [ref: > PaymentSchedules.paymentschedule_id]
//  done_at timestamp
//  payment_date date
//  payment_method enum('credit', 'debit')
//}

// credentials needed for the job
Table job_credentials {
    id int [pk, increment]
    credentials_id int [not null, ref: > credentials.id]
    job_id int [not null, ref: > jobs.id]
}

// Expenses
Table expenses {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  worker_id int [not null, ref: > healthcare_workers.id]
  schedule_id int [not null, ref: > care_schedules.id]
  expense_date date [not null]
  description varchar(255) [not null]
  payment_method enum("cash", "debit", "credit", "direct_deposit", "digital_wallet", "cheque") [not null]
  category enum("groceries", "medical", "ppe", "supplies", "parking", "travel", "meals", "incidental", "entertainment", "other") [not null]
  amount decimal(10, 2) [not null]
  currency varchar(3) [not null, default: "CAD"]
  receipt_url varchar(255) [null]
  notes text [null]
  status enum("pending", "approved", "rejected") [not null]
  approved_by int [null, ref: > users.id]
  approved_at timestamp [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    patient_id
    worker_id
    schedule_id
    category
    status
    expense_date
  }
}

// probably wrong we don't want to store same info as Expenses
Table users_transactions {
  id int [pk, increment]
  wallet_id int [not null, ref: > users_wallets.id]
  recorded_by int [not null, ref: > healthcare_workers.id]
  job_id int [not null, ref: > jobs.id]
  transaction_type enum("Expense", "Deposit", "Refund", "Adjustment", 'invoice payment') [not null]
  category enum("HCW Service", "Medical Supply", "Transportation", "Other") [not null]
  amount decimal(10,2) [not null]
  payment_method enum("Cash", "Credit Card", "Insurance", "Wallet Deduction") [not null]
  status enum("Pending", "Completed", "Reversed", 'declined') [not null]
  created_at timestamp [not null]
  notes text [null]
}

// Payment methods
Table payment_methods {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  type enum("credit_card", "debit_card", "bank_account") [not null]
  provider varchar(50) [not null] // "visa", "mastercard", "amex", etc.
  last_four varchar(4) [not null]
  expiry_month int [null]
  expiry_year int [null]
  is_default boolean [default: false]
  status enum("active", "expired", "cancelled") [not null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    user_id
    type
    status
  }
}

// Generated pay stubs
Table pay_stubs_generated {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  schedule_id int [not null, ref: > care_schedules.id]
  period_start date [not null]
  period_end date [not null]
  total_hours decimal(5,2) [not null]
  regular_hours decimal(5,2) [not null]
  overtime_hours decimal(5,2) [not null]
  regular_rate decimal(10,2) [not null]
  overtime_rate decimal(10,2) [not null]
  gross_pay decimal(10,2) [not null]
  deductions decimal(10,2) [not null]
  net_pay decimal(10,2) [not null]
  status enum("draft", "published", "paid") [not null]
  generated_by int [not null, ref: > users.id]
  generated_at timestamp [not null]
  paid_at timestamp [null]
  document_url varchar(255) [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    worker_id
    schedule_id
    status
    (period_start, period_end)
  }
}

// Job messages
// fix this
Table job_messages {
  id int [pk, increment]
  job_id int [not null, ref: > jobs.id]
  sender_id int [not null, ref: > users.id]
  receiver_id int [not null, ref: > users.id]
  message_text text [not null]
  attachment_url varchar(255) [null]
  job_application_id int [null, ref: > healthcare_workers_job_applications.id]
  hcwjob_id int [ref: > healthcare_workers_jobs.id]
  job_application_id int [null, ref: > job_applications.id]
  sent_at timestamp [null]
  is_read boolean [default: false]
  created_at timestamp [default: now()]
  deleted_at timestamp [null]

  indexes {
    job_id
    sender_id
    receiver_id
    is_read
    created_at
  }
}

// Healthcare workers base table
Table healthcare_workers {
  id int [pk, increment]
  first_name varchar(100) [not null]
  last_name varchar(100) [not null]
  middle_name varchar(100) [null]
  business_name varchar(255) [null]
  legal_name varchar(255) [null]
  email varchar(255) [unique, not null]
  apple_email varchar(255) [unique, null]
  google_email varchar(255) [unique, null]
  facebook_id varchar(255) [unique, null]
  hashed_password varchar(255) [not null]
  date_of_birth date [not null]
  sin_ssn varchar(20) [unique, not null]
  gender enum("male", "female", "other") [not null]
  contact_info varchar(255) [not null]
  ethnicity_id int [null, ref: > ethnicities.id]
  status enum("active", "inactive_temporary", "leave_illness", "leave_parental", "leave_other", "terminated") [not null]
  profile_picture varchar(255) [null]
  intro_video varchar(255) [null]
  experience_years int [null]
  membership_start date [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]
  deleted_at timestamp [null]
  notes text [null]

  indexes {
    (first_name, last_name)
    email
    status
    experience_years
    membership_start
    (status, deleted_at)
    (experience_years, status)
    ethnicity_id
  }
}

// Healthcare worker rates
Table healthcare_worker_rates {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  //category_id int [not null, ref: > HealthcareWorkerCategories.id]
  //subcategory_id int [ref: > HealthcareWorkerSubcategories.id]
  rate decimal(10,2) [not null]
  rate_type enum('hourly', 'daily', 'contract', 'live_in_daily') [not null]
  effective_date date [not null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    (worker_id, rate_type)
    effective_date
    (worker_id, effective_date)
  }
}

// Healthcare worker expertise
Table healthcare_worker_expertise {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
  created_at timestamp [default: now()]
}

// Healthcare worker expertise assignments
Table healthcare_worker_expertise_assignments {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  expertise_id int [not null, ref: > healthcare_worker_expertise.id]
  assigned_at date [not null]
  notes text [null]
  created_at timestamp [default: now()]

  indexes {
    (worker_id, expertise_id)
  }
}

// Healthcare worker shifts
Table healthcare_workers_shifts {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  notes text [null]
  created_at timestamp [default: now()]
}

// Healthcare worker shift preferences
Table healthcare_workers_shift_preferences {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  shift_id int [not null, ref: > healthcare_workers_shifts.id]
  created_at timestamp [default: now()]

  indexes {
    (worker_id, shift_id)
  }
}

// Healthcare worker schedules
Table healthcare_workers_schedules {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
  created_at timestamp [default: now()]
}

// Healthcare worker schedule preferences
Table healthcare_workers_schedule_preferences {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  schedule_id int [not null, ref: > healthcare_workers_schedules.id]
  hours_range enum('1-8', '8-20', '20-40', '40+') [not null]
  start_date date [not null]
  created_at timestamp [default: now()]

  indexes {
    (worker_id, schedule_id)
    start_date
  }
}

// Healthcare worker addresses
Table healthcare_workers_addresses {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  unit_no varchar(50) [null]
  street_address varchar(255) [not null]
  city varchar(100) [not null]
  province varchar(100) [not null]
  postal_code varchar(20) [not null]
  country varchar(100) [not null]
  is_primary boolean [default: false]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    worker_id
    postal_code
    (city, province, country)
  }
}

// Healthcare worker categories
Table healthcare_workers_categories {
  id int [pk, increment]
  name varchar(100) [not null, unique]
  description text [null]
  created_at timestamp [default: now()]
}

// Healthcare worker category assignments
Table healthcare_workers_category_assignments {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  category_id int [not null, ref: > healthcare_workers_categories.id]
  created_at timestamp [default: now()]

  indexes {
    (worker_id, category_id)
  }
}

// Healthcare worker contacts
Table healthcare_workers_contacts {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  email_address varchar(255) [null]
  phone_number varchar(20) [null]
  is_primary boolean [default: false]
  contact_type enum("personal", "emergency", "business", "reference", "other") [not null]
  relationship varchar(100) [null] // For emergency contacts: family member, friend, etc.
  phone_verified boolean [default: false]
  email_verified boolean [default: false]
  preferred_contact_method enum("email", "phone", "both") [not null]
  contact_availability json [null] // Store preferred contact hours/days
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]
  deleted_at timestamp [null]

  indexes {
    worker_id
    (email_address, phone_number)
    contact_type
    is_primary
    (worker_id, contact_type, is_primary)
  }
}

// Healthcare worker credentials
Table healthcare_workers_credentials {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  credential_id int [not null, ref: > credentials.id]
  issue_date date [null]
  expiration_date date [null]
  certification_authority varchar(255) [null]
  document_link varchar(255) [null]
  document_number varchar(100) [null]
  verification_status enum("pending", "verified", "expired") [not null, default: "pending"]
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    (worker_id, credential_id)
    expiration_date
    verification_status
  }
}

// Healthcare worker services
Table healthcare_workers_services {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  service_id int [not null, ref: > services.id]
  created_at timestamp [default: now()]

  indexes {
    (worker_id, service_id)
  }
}

// Healthcare worker jobs
Table healthcare_workers_jobs {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  job_id int [not null, ref: > jobs.id]
  status enum('active', 'completed', 'terminated', 'resigned') [not null]
  hired_at timestamp [null]
  start_date date [not null]
  end_date date [not null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    (worker_id, job_id)
    status
    start_date
    end_date
  }
}

// Healthcare worker job applications
Table healthcare_workers_job_applications {
  id int [pk, increment]
  job_id int [not null, ref: > jobs.id]
  worker_id int [not null, ref: > healthcare_workers.id]
  status enum("pending", "shortlisted", "interview", "meet_and_greet", "hired", "rejected") [not null]
  applied_at timestamp [not null]
  hired_at timestamp [null]
  resume_url varchar(255) [null]
  cover_letter text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    (worker_id, job_id)
    status
    applied_at
  }
}

// Ethnicities terms
Table ethnicities {
  id int [pk, increment]
  name varchar(100) [not null, unique]
  description text [null]
}

Table healthcare_workers_tags {
  worker_id int [not null, ref: > healthcare_workers.id]
  tag_id int [not null, ref: > tags.id]
  primary key (worker_id, tag_id)
}

// Tags terms
Table tags {
  id int [pk, increment]
  name varchar(255) [not null, unique]
  description text [null]
}

// services terms info
Table services {
  id int [pk, increment]
  name varchar [not null, unique]
  description text [null]
}

// skills terms info
Table skills {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
}

// Multi-factor authentication support
Table mfa_settings {
  id          int [pk, increment]
  user_id     int [not null, ref: > users.id]
  type        enum("authenticator_app", "sms", "email") [not null]
  secret      varchar(255) [not null] // Encrypted MFA secret
  backup_codes json [null] // Encrypted backup codes
  enabled     boolean [default: false]
  created_at  timestamp [default: now()]
  updated_at  timestamp [default: now()]

  indexes {
    user_id
  }
}

// API access management
Table api_keys {
  id          int [pk, increment]
  user_id     int [not null, ref: > users.id]
  key_hash    varchar(255) [not null] // Hashed API key
  name        varchar(100) [not null] // Purpose/name of the key
  permissions json [not null] // Specific permissions for this key
  last_used   timestamp [null]
  expires_at  timestamp [null]
  created_at  timestamp [default: now()]
  revoked_at  timestamp [null]

  indexes {
    key_hash
    user_id
  }
}

// Role-based access control
Table roles {
  id          int [pk, increment]
  name        varchar(100) [unique, not null]
  description text [null]
  created_at  timestamp [default: now()]
}

Table user_roles {
  id         int [pk, increment]
  user_id    int [not null, ref: > users.id]
  role_id    int [not null, ref: > roles.id]
  created_at timestamp [default: now()]

  indexes {
    (user_id, role_id) [unique]
  }
}

Table permissions {
  id          int [pk, increment]
  name        varchar(100) [unique, not null]
  description text [null]
  created_at  timestamp [default: now()]
}

Table role_permissions {
  role_id       int [not null, ref: > roles.id]
  permission_id int [not null, ref: > permissions.id]
  created_at    timestamp [default: now()]

  indexes {
    (role_id, permission_id) [unique]
  }
}

// Audit logging
Table audit_logs {
  id            int [pk, increment]
  user_id       int [null, ref: > users.id] // Null for system actions
  action        varchar(100) [not null]
  entity_type   varchar(100) [not null] // Table name
  entity_id     int [not null] // Primary key of affected record
  changes       json [not null] // Before/after values
  ip_address    varchar(45) [not null]
  user_agent    text [null]
  created_at    timestamp [default: now()]

  indexes {
    user_id
    entity_type
    entity_id
    created_at
  }
}

// Rate limiting
Table rate_limits {
  id            int [pk, increment]
  ip_address    varchar(45) [not null]
  endpoint      varchar(255) [not null]
  request_count int [not null]
  window_start  timestamp [not null]
  created_at    timestamp [default: now()]

  indexes {
    (ip_address, endpoint)
    window_start
  }
}

// Version control for care plans
Table care_plan_versions {
  id           int [pk, increment]
  care_plan_id int [not null, ref: > care_plans.id]
  version      int [not null]
  changes      json [not null]
  created_by   int [not null, ref: > users.id]
  created_at   timestamp [default: now()]

  indexes {
    (care_plan_id, version) [unique]
  }
}

// Application documents
Table application_documents {
  id int [pk, increment]
  application_id int [not null, ref: > healthcare_workers_job_applications.id]
  document_type enum("resume", "certification", "reference", "other") [not null]
  file_url varchar(255) [not null]
  uploaded_at timestamp [not null]
  created_at timestamp [default: now()]

  indexes {
    application_id
    document_type
  }
}

// Credentials
Table credentials {
  id int [pk, increment]
  name varchar(255) [not null, unique]
  description text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]
}

// Work environment exceptions
Table work_environment_exceptions {
  id int [pk, increment]
  name varchar(200) [unique, not null]
  description text [null]
  created_at timestamp [default: now()]
}

// Healthcare worker environment preferences
Table healthcare_workers_environment_preferences {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  exception_id int [not null, ref: > work_environment_exceptions.id]
  created_at timestamp [default: now()]

  indexes {
    (worker_id, exception_id)
  }
}

// Healthcare worker skills
Table healthcare_workers_skills {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  skill_id int [not null, ref: > skills.id]
  proficiency_level enum("beginner", "intermediate", "advanced", "expert") [not null]
  years_experience int [null]
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    (worker_id, skill_id)
    proficiency_level
  }
}

// Healthcare worker wallet
Table healthcare_workers_wallets {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  balance decimal(10, 2) [not null]
  currency varchar(3) [not null, default: "CAD"]
  last_updated timestamp [not null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    worker_id
    currency
  }
}

// Healthcare worker performance metrics
Table healthcare_workers_performance_metrics {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
  created_at timestamp [default: now()]
}

// Healthcare worker performance records
Table healthcare_workers_performance_records {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  metric_id int [not null, ref: > healthcare_workers_performance_metrics.id]
  rating int [not null, note: "Scale of 1-5"]
  review_period_start date [not null]
  review_period_end date [not null]
  reviewer_id int [not null, ref: > users.id]
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    (worker_id, metric_id)
    rating
    review_period_start
    review_period_end
  }
}

// Healthcare worker activity logs
Table healthcare_workers_activity_logs {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  last_calendar_update date [not null]
  last_login date [not null]
  member_since date [not null]
  total_bookings int [not null]

  indexes {
    worker_id
  }
}

// Healthcare worker availability
Table healthcare_workers_availability {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  day_of_week enum("monday", "tuesday", "wednesday", "thursday", "friday", "saturday", "sunday") [not null]
  start_time time [not null]
  end_time time [not null]
  is_recurring boolean [default: true]
  effective_start_date date [not null]
  effective_end_date date [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    worker_id
    day_of_week
    (effective_start_date, effective_end_date)
  }
}

// Healthcare worker notifications
Table healthcare_workers_notifications {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  type enum("schedule_change", "new_job_match", "credential_expiring", "payment_received", "performance_review") [not null]
  title varchar(255) [not null]
  message text [not null]
  is_read boolean [default: false]
  metadata json [null]
  created_at timestamp [default: now()]

  indexes {
    worker_id
    type
    is_read
    created_at
  }
}

// Care plans - Comprehensive patient care management
Table care_plans {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  job_id int [not null, ref: > jobs.id]
  //primary_caregiver_id int [null, ref: > healthcare_workers.id]
  created_by int [not null, ref: > users.id]
  status enum("draft", "active", "completed", "archived") [not null]
  description text [null]
  start_date date [not null]
  end_date date [not null]
  created_by int [not null, ref: > users.id]
  created_at timestamp [default: now()]
  updated_at timestamp [null]
}

// Care plan team members
Table care_plan_team_members {
  id int [pk, increment]
  care_plan_id int [not null, ref: > care_plans.id]
  worker_id int [not null, ref: > healthcare_workers.id]
  role enum("primary_caregiver", "secondary_caregiver", "support_worker", "therapist", "nurse", "physician", "specialist", "other") [not null]
  start_date date [not null]
  end_date date [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]
  deleted_at timestamp [null]

  indexes {
    care_plan_id
    worker_id
    role
    (start_date, end_date)
  }
}

// Care schedules
// TODO: check for compaibility with jobs and care plans
// care schedules associated with a care plan
Table care_schedules {
  id integer [pk, increment]
  patient_id int [not null, ref: > patients.id]
  care_plan_id int [not null, ref: > care_plans.id]
  worker_id int [null, ref: > healthcare_workers.id]
  //user_id INT [not null, ref: > users.user_id]
  total_hours integer [not null]
  start_time timestamp [not null]
  end_time timestamp [not null]
  location varchar(255) [not null]
  status enum("pending", "completed", "cancelled", "missed") [not null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    patient_id
    care_plan_id
    worker_id
    status
    (start_time, end_time)
    (worker_id, status)
    (patient_id, status)
    (care_plan_id, status)
    location
  }
}

// Jobs
Table jobs {
  id integer [pk, increment]
  user_id int [not null, ref: > users.id]
  patient_id int [not null, ref: > patients.id]
  status enum("draft", "active", "paused", "closed", "reposted") [not null]
  position varchar(255) [not null]
  currency varchar(10) [not null, default: "CAD"]
  employment_class enum("permanent_pt", "permanent_ft", "temporary_pt", "temporary_ft", "casual") [not null]
  description text [not null]
  nursing_activity boolean [not null]
  childcare_activity boolean [not null]
  supportworker_activity boolean [not null]
  total_budget decimal(10,2) [null]
  hourly_rate decimal(10,2) [null]
  live_in_daily_rate decimal(10,2) [null]
  care_recurrence_type enum("one_time", "repeat_weekly") [not null]
  shift_type enum("day", "night", "live_in") [not null]
  start_date date [not null]
  end_date date [not null]
  start_time time [not null]
  end_time time [not null]
  total_weekly_hours decimal(5,2) [not null]
  expected_care_duration int [not null]
  experience_years_required int [null]
  job_type enum("employment", "contractor", "volunteer", "sponsorship") [not null]
  schedule_type enum("permanent_pt", "permanent_ft", "temporary_pt", "temporary_ft", "casual") [not null]
  salary_type enum("hourly", "weekly", "biweekly", "monthly", "annual") [not null]
  pay_period_schedule enum("Bi-Weekly (26/year)", "Bi-Weekly (27/year)", "Manual", "Monthly (12/year)", "Semi-Monthly Non-Standard", "Weekly") [not null]
  policy_group enum("Webookcare App Healthcare Workers") [not null]
  permission_group enum("Regular Employee (Punch In/Out)", "Admin", "Manager") [not null]
  work_days json [not null] // Array of days: ["monday", "tuesday", etc.]
  additional_notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]
  deleted_at timestamp [null]

  indexes {
    user_id
    patient_id
    status
    position
    employment_class
    job_type
    (start_date, end_date)
  }
}

// Job credentials required
Table jobs_required_credentials {
  id int [pk, increment]
  job_id int [not null, ref: > jobs.id]
  credential_id int [not null, ref: > credentials.id]
  is_mandatory boolean [default: true]
  created_at timestamp [default: now()]

  indexes {
    (job_id, credential_id)
  }
}

// Job services required
Table jobs_required_services {
  id int [pk, increment]
  job_id int [not null, ref: > jobs.id]
  service_id int [not null, ref: > services.id]
  service_routine enum("morning", "lunch", "afternoon", "dinner", "evening") [null]
  is_scheduled boolean [not null]
  schedule_days json [null] // Array of days when service is needed
  notes text [null]
  created_at timestamp [default: now()]

  indexes {
    (job_id, service_id)
    service_routine
  }
}

// Job work environment exceptions
Table job_environment_exceptions {
  id int [pk, increment]
  job_id int [not null, ref: > jobs.id]
  exception_id int [not null, ref: > work_environment_exceptions.id]
  created_at timestamp [default: now()]

  indexes {
    (job_id, exception_id)
  }
}

// Job required languages
Table job_required_languages {
  id int [pk, increment]
  job_id int [not null, ref: > jobs.id]
  language_id int [not null, ref: > languages.id]
  proficiency_level enum("basic", "intermediate", "fluent", "native") [not null]
  is_mandatory boolean [default: true]
  created_at timestamp [default: now()]

  indexes {
    (job_id, language_id)
    proficiency_level
  }
}

// TODO: check for duplications
// historical data for building patient profiles for later
Table patients_preferred_languages {
    id int [pk, increment]
    language_id int [not null, ref: > languages.id]
    patient_id int [not null, ref: > patients.id]
}

// TODO: check for duplications
// historical data for building user profiles for later use
Table users_preferred_languages {
    id int [pk, increment]
    language_id int [not null, ref: > languages.id]
    user_id int [not null, ref: > users.id]
}

// historical info for building patient profiles for later use
Table patients_preferred_skills {
    id int [pk, increment]
    skill_id int [not null, ref: > skills.id]
    patient_id int [not null, ref: > patients.id]
}

// historical info for building user profiles for later use
Table users_preferred_skills {
    id int [pk, increment]
    skill_id int [not null, ref: > skills.id]
    user_id int [not null, ref: > users.id]
}

// historical info for building patient profiles for later use
Table patients_preferred_credentials {
    id int [pk, increment]
    credentials_id int [not null, ref: > credentials.id]
    patient_id int [not null, ref: > patients.id]
}

// historical info for building user profiles for later use
Table users_preferred_credentials {
    id int [pk, increment]
    credentials_id int [not null, ref: > credentials.id]
    user_id int [not null, ref: > users.id]
}

// info for child care activities
Table child_care_activities {
    id int [pk, increment]
    name varchar(100) [unique, not null]
    description text [null]
}

// jobs involving child care activities and hcw who did the job
Table jobs_child_care_activities {
    id int [pk, increment]
    job_id int [not null, ref: > jobs.id]
    hcw_id int [not null, ref: > healthcare_workers.id]
    notes text [null]
}

// info for adult care activities
Table adult_care_activities {
    id int [pk, increment]
    name varchar(100) [unique, not null]
    description text [null]
}

// adult care activities for a specific job
Table jobs_adult_care_activities {
    id int [pk, increment]
    job_id int [not null, ref: > jobs.id]
    hcw_id int [not null, ref: > healthcare_workers.id]
    notes text [null]
}

// care plan for a specific job, patient
Table care_plans {
  id int [pk, increment]
  patient_id int [not null, ref: > patients.id]
  job_id int [not null, ref: > jobs.id]
  description text [null]
  start_date date [not null]
  end_date date [not null]
  created_at timestamp [not null]
  updated_at timestamp [null]
}

// care team assigned for the care plan
Table care_plan_care_team {
  id int [pk, increment]
  care_plan_id int [not null, ref: > care_plans.id]
  hcw_id int [not null, ref: > healthcare_workers.id]
  role enum("Primary Caregiver", "Secondary Caregiver", "Support Worker", "Therapist", "Nurse", "Physician", "Specialist", "Other") [not null]
  notes text [null]
}

// chartting for care plans for a patient during a job
Table care_plan_chartting {
  id int [primary key, increment]
  patient_id int [not null, ref: > patients.id]
  hcw_id int [not null, ref: > healthcare_workers.id]
  care_plan_id int [not null, ref: > care_plan.id]
  chart_date timestamp [not null]
  vital_signs json [null]
  medications_administered json [null]
  daily_care_activities text [null]
  symptoms_observed text [null]
  meal_intake text [null]
  bowel_bladder text [null]
  wound_care text [null]
  mood_behavior text [null]
  emergency_situations text [null]
  additional_notes text [null]
  attachments json [null]
  signature varchar(255) [not null]
  updated_at timestamp [null]
}

// Join table for the many-to-many relationship
Table jobs_credentials {
  job_id int [not null, ref: > jobs.id]
  credential_id int [not null, ref: > credentials.id]
  primary key (job_id, credential_id)
}

// Join table for the many-to-many relationship
Table jobs_services {
  job_id int [not null, ref: > jobs.id]
  service_id int [not null, ref: > services.id]
  primary key (job_id, service_id)
}

// Join table for the many-to-many relationship
Table jobs_personal_interests {
  job_id int [not null, ref: > jobs.id]
  interest_id int [not null, ref: > personal_interests.id]
  primary key (job_id, interest_id)
}

// base table for healthcare workers info
Table healthcare_workers {
  id int [pk, increment]
  first_name varchar(100) [not null]
  last_name varchar(100) [not null]
  middle_name varchar(100) [null]
  business_name varchar(255) [null]
  legal_name varchar(255) [null]
  email varchar(255) [unique, not null]
  hashed_password varchar(255) [not null]
  date_of_birth date [not null]
  sin_ssn varchar(20) [unique, not null]
  gender enum("Male", "Female", "Other") [not null]
  contact_info varchar(255) [not null]
  ethnicity int [null, ref: > Ethnicities.id]
  status enum("Active", "Inactive (Temporary)", "Leave - Illness/Injury", "Leave - Maternity/Parental", "Leave - Other", "Terminated/Quit") [not null]
  profile_picture varchar(255) [null]
  intro_video varchar(255) [null]
  experience_years int [null]
  membership_start date [null]
  updated_at timestamp [not null]
  notes text [null]
}

Table rates {
  id int [pk, increment]
  hcw_id int [not null, ref: > healthcare_workers.id]
  //category_id int [not null, ref: > HealthcareWorkerCategories.id]
  //subcategory_id int [ref: > HealthcareWorkerSubcategories.id]
  rate decimal(10,2) [not null]
  rate_type enum('hourly', 'daily', 'contract', 'live-in flat daily') [not null]
  effective_date date [not null]
}

// healthcare worker expertise terms
Table healthcare_workers_expertises {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
}

// Healthcare worker expertise info
Table healthcare_workers_expertises_info {
  id int [pk, increment]
  hcw_id int [not null, ref: > healthcare_workers.id]
  expertise_id int [not null, ref: > healthcare_workers_expertises.id]
  assign_date date [not null]
  notes text [null]
}

// TAGS: INCLUDED_V2
// shifts terms for hcw
Table healthcare_workers_shifts {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  created_at timestamp [not null]
  updated_at timestamp [not null]
  notes text [null]
}

// TAGS: INCLUDED_V2
// shifts preferrence for hcw
Table healthcare_workers_preferred_shifts {
  id int [pk, increment]
  hcw_id int [not null, ref: > healthcare_workers.id]
  shift_id int [not null, ref: > healthcare_workers_shifts.id]
  assigned_at timestamp [not null]
  updated_at timestamp [not null]
  notes text [null]
}

// TAGS: INCLUDED_V2
// healthcare worker schedules types ["Permanent P/T", "Permanent F/T", "Temporary P/T", "Temporary F/T", "Casual"]
Table healthcare_workers_schedules {
  id int [pk, increment]
  name varchar(100) [unique, not null]
  description text [null]
  created_at timestamp [not null]
  updated_at timestamp [not null]
}

// TAGS: INCLUDED_V2
// healthcare worker schedules preferrence
Table healthcare_workers_preferred_schedules {
  id int [pk, increment]
  hcw_id int [not null, ref: > healthcare_workers.id]
  schedule_id int [not null, ref: > healthcare_workers_schedules.id]
  num_hours enum('1-8', '8-20', '20-40', '40+') [not null]
  start_date date [not null]
  created_at timestamp [not null]
  updated_at timestamp [not null]
}

// TAGS: INCLUDED_V2
// address history info for HCWs
Table healthcare_workers_addresses {
  id int [pk, increment] // Unique Address ID
  hcw_id int [not null, ref: > healthcare_workers.id]
  unit_no varchar(50) [null]
  street_address varchar(255) [not null]
  city varchar(100) [not null]
  province varchar(100) [not null]
  postal_code varchar(20) [not null]
  country varchar(100) [not null]
  created_at timestamp [not null]
  updated_at timestamp [not null]
}

// TAGS: INCLUDED_V2, TO_BE_REVIEWED
// hcw categories [Nursing, Childcare, Support Worker, etc.]
Table healthcare_workers_categories {
    id int [pk, increment]
    category varchar(100) [not null, unique]
    description text [null]
    created_at timestamp [default: now()]
    updated_at timestamp [default: now()]
}

// TAGS: INCLUDED_V2, TO_BE_REVIEWED
// the categories hcw belongs to or works in
Table healthcare_workers_categories_info {
  id int [pk, increment]
  hcw_id int [not null, ref: > healthcare_workers.id]
  hcw_categories_id int [not null, ref: > healthcare_workers_categories.id]
  assigned_at timestamp [default: now()]
  updated_at timestamp [default: now()]
}

// TAGS: INCLUDED_V2, TO_BE_REVIEWED
// the subcategories hcw belongs to or works in
Table healthcare_workers_subcategories_info {
    id int [pk, increment]
    hcw_id int [not null, ref: > healthcare_workers.id]
    hcw_subcategory_id int [not null, ref: > healthcare_workers_subcategories.id]
    assigned_at timestamp [default: now()]
    updated_at timestamp [default: now()]
}

// TAGS: INCLUDED_V2, TO_BE_REVIEWED
// subcategories for hcw categories [nanny for child care, etc.]
Table healthcare_workers_subcategories {
    id int [pk, increment]
    cat_id int [not null, ref: > healthcare_workers_categories.id]
    created_at timestamp [default: now()]
    updated_at timestamp [default: now()]
    notes text [null]
}

// TAGS: TO_BE_REVIEWED
// positions vocab for HCWs
Table healthcare_workers_positions {
    id int [pk, increment]
    name varchar(100) [not null, unique]
    notes text [null]
}

// TAGS: TO_BE_REVIEWED
// historical info for HCW positions
Table healthcare_workers_positions_info {
    id int [pk, increment]
    hcw_id int [not null, ref: > healthcare_workers.id]
    hcw_position_id int [not null, ref: > healthcare_workers_positions.id]
    start_date date [not null]
    end_date date [null]
    notes text [null]
    created_at timestamp [default: now()]
    updated_at timestamp [default: now()]
}

// TAGS: TO_BE_REVIEWED, DUPLICATED
// contacts info for HCWs
// TODO: check and fix like other tables
Table healthcare_workers_contacts {
  id int [pk, increment]
  hcw_id int [not null, ref: > healthcare_workers.id]
  email_address varchar(255) [null]
  phone_number varchar(20) [null]
  is_primary boolean [default: false]
  contact_type enum("personal", "emergency", "business", "reference", "other") [not null]
  relationship varchar(100) [null] // For emergency contacts: family member, friend, etc.
  phone_verified boolean [default: false]
  email_verified boolean [default: false]
  preferred_contact_method enum("email", "phone", "both") [not null]
  contact_availability json [null] // Store preferred contact hours/days
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]
  deleted_at timestamp [null]

  indexes {
    worker_id
    (email_address, phone_number)
    contact_type
    is_primary
    (worker_id, contact_type, is_primary)
  }
}

// TAGS: TO_BE_REVIEWED
// TODO: verify design stat
// notes info for HCWs
Table healthcare_workers_notes {
  id int [pk, increment]
  hcw_id int [not null, ref: > healthcare_workers.id]
  notes text [not null]
  created_at timestamp [not null]
}

// TODO: verify TAGS
// TAGS: INCLUDED_V2
// documents uploaded by HCWs for a specific application
Table job_application_documents {
  id int [pk, increment]
  application_id int [not null, ref: > job_applications.id]
  document_type enum("Resume", "Certification", "Reference", "Other") [not null]
  file_url varchar [not null]
  uploaded_at timestamp [not null]
  notes text [null]
}

// TAGS: INCLUDED_V2
// work environment exceptions preferrence for hcw
Table healthcare_workers_preferred_environment_exceptions {
  id int [pk, increment]
  hcw_id int [not null, ref: > healthcare_workers.id]
  exception_id int [not null, ref: > work_environment_exceptions.id]
  assigned_at timestamp [null]
  updated_at timestamp [null]
}

// TAGS: INCLUDED_V2
// Healthcare worker secondary emails
Table healthcare_worker_emails {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  email varchar(255) [unique, not null]
  is_primary boolean [default: false]
  verified boolean [default: false]
  assigned_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    (worker_id, email) [unique]
  }
}


























// SECURITY DATA Section

// Healthcare worker authentication methods
Table healthcare_worker_auth {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  provider_id int [not null, ref: > auth_providers.id]
  provider_uid varchar(255) [not null] // External provider's user ID
  email varchar(255) [null] // Email associated with this auth method
  access_token text [null] // OAuth access token
  refresh_token text [null] // OAuth refresh token
  token_expires_at timestamp [null]
  last_login_at timestamp [null]
  is_primary boolean [default: false] // Primary auth method for worker
  metadata json [null] // Additional provider-specific data
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    (worker_id, provider_id) [unique]
    provider_uid
    email
    is_primary
    last_login_at
  }
}

// Healthcare worker phone verification
Table healthcare_worker_phone_verifications {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  phone_number varchar(20) [not null]
  verification_code varchar(6) [not null] // SMS verification code
  is_verified boolean [default: false]
  expires_at timestamp [not null] // Code expiration time
  attempts int [default: 0] // Number of verification attempts
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]
  verified_at timestamp [null]
  
  indexes {
    (worker_id, phone_number) [unique] // One verification process per phone number
    verification_code
    expires_at
  }
}

// Healthcare worker security logs
Table healthcare_worker_security_logs {
  id int [pk, increment] 
  worker_id int [not null, ref: > healthcare_workers.id]
  action enum("failed_login", "successful_login", "password_reset_requested", "password_reset_completed", "account_locked", "account_unlocked", "mfa_enabled", "mfa_disabled", "suspicious_activity", "ip_change", "device_change", "password_changed", "email_changed", "profile_updated") [not null]
  ip_address varchar(45) [not null]
  user_agent text
  location json [null] // City, country, coordinates
  device_info json [null] // OS, browser, etc
  metadata json [null]
  severity enum("info", "warning", "critical") [not null]
  created_at timestamp [default: now()]

  indexes {
    worker_id
    action
    severity  
    created_at
    ip_address
  }
}

// Healthcare worker sessions
Table healthcare_worker_sessions {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  session_token varchar(255) [not null]
  ip_address varchar(45) [not null]
  user_agent text
  device_info json [null]
  location json [null]
  expires_at timestamp [not null]
  created_at timestamp [default: now()]
  last_activity timestamp [default: now()]
  ended_at timestamp [null]
  end_reason enum("expired", "logged_out", "session_invalidated") [null]

  indexes {
    session_token
    worker_id
    expires_at
    ip_address
  }
}

// Healthcare worker login statistics
Table healthcare_worker_login_stats {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  successful_logins int [default: 0]
  failed_attempts int [default: 0]
  last_failed_at timestamp [null]
  last_success_at timestamp [null]
  password_resets int [default: 0]
  suspicious_activities int [default: 0]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    worker_id
  }
}

// Healthcare worker MFA settings
Table healthcare_worker_mfa_settings {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  type enum("authenticator_app", "sms", "email") [not null]
  secret varchar(255) [not null] // Encrypted MFA secret
  backup_codes json [null] // Encrypted backup codes
  enabled boolean [default: false]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    worker_id
  }
}

// Healthcare worker password resets
Table healthcare_worker_password_resets {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  reset_token varchar(255) [not null]
  expires_at timestamp [not null]
  created_at timestamp [default: now()]
  used boolean [default: false]
  ip_address varchar(45) [not null]
  user_agent text
  success boolean [default: false]

  indexes {
    reset_token
    worker_id
    expires_at
  }
}




// SUGGESTIONS Section

// SUGGESTION: tracking sharing of careplans
// which hcw have access to a careplan
Table care_plan_shares {
  id int [pk, increment]
  careplan_id int [not null, ref: > care_plans.id]
  hcw_id int [not null, ref: > healthcare_workers.id]
  status enum("pending", "accepted", "declined") [not null]
}

// Linked social media accounts
Table social_media_accounts {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  platform enum("twitter", "linkedin", "instagram", "tiktok", "youtube", "facebook", "pinterest", "snapchat") [not null]
  username varchar(255) [not null]
  profile_url varchar(255) [null]
  account_verified boolean [default: false]
  follower_count int [null]
  is_business_account boolean [default: false]
  engagement_rate decimal(5,2) [null]
  last_synced_at timestamp [null]
  access_token text [null]
  refresh_token text [null]
  token_expires_at timestamp [null]
  metadata json [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]
  deleted_at timestamp [null]

  indexes {
    (user_id, platform) [unique]
    username
    platform
    is_business_account
    account_verified
  }
}


// HISTORICAL DATA Section

// TAGS: INCLUDED_V2
// Tracks HCWs' historical job info (only if hired)
Table healthcare_workers_jobs {
  id int [pk, increment]
  hcw_id int [not null, ref: > healthcare_workers.id]
  job_id int [not null, ref: > jobs.id]
  status enum('active', 'completed', 'terminated', 'resigned') [not null]
  hired_at timestamp [null]
  start_date date [not null]
  end_date date [not null]
  created_at timestamp [null]
  updated_at timestamp [null]
}

// TAGS: INCLUDED_V2
// activity info stored for a HCW
Table healthcare_workers_activity {
  id int [pk, increment]
  last_calendar_update date [not null]
  last_login date [not null]
  member_since date [not null]
  total_no_bookings int [not null]
}

// Track patient management history - records individual changes
Table user_patient_management_history {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  patient_id int [not null, ref: > patients.id]
  action enum("added", "removed") [not null]
  previous_state json [null]
  new_state json [null]
  notes text [null]
  //performed_by int [not null, ref: > users.id]
  created_at timestamp [default: now()]

  indexes {
    user_id
    patient_id
    action
    //performed_by
    created_at
  }
}

// Current active patient management assignments
Table user_managed_patients {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  patient_id int [not null, ref: > patients.id]
  relationship enum("primary_caregiver", "family_member", "guardian", "power_of_attorney", "healthcare_proxy", "case_manager", "other") [not null]
  is_primary_manager boolean [default: false]
  access_level enum("full", "limited", "read_only") [not null]
  start_date date [not null]
  end_date date [null]
  notes text [null]
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]
  deleted_at timestamp [null]

  indexes {
    (user_id, patient_id) [unique] // Ensures no duplicate assignments
    relationship
    is_primary_manager
    access_level
    (start_date, end_date)
  }

  // Ensure no overlapping date ranges for same user-patient pair
  checks {
    no_overlap: "NOT EXISTS (
      SELECT 1 FROM user_managed_patients p2 
      WHERE p2.user_id = user_id 
      AND p2.patient_id = patient_id
      AND p2.id != id
      AND p2.deleted_at IS NULL
      AND (
        (start_date BETWEEN p2.start_date AND COALESCE(p2.end_date, '9999-12-31'))
        OR (COALESCE(end_date, '9999-12-31') BETWEEN p2.start_date AND COALESCE(p2.end_date, '9999-12-31'))
      )
    )"
  }
}

// Current aggregated statistics - updated periodically
Table user_patient_management_stats {
  id int [pk, increment]
  user_id int [not null, ref: > users.id]
  total_patients_managed int [default: 0]
  active_patients int [default: 0]
  completed_care_plans int [default: 0]
  active_care_plans int [default: 0]
  total_care_hours decimal(10,2) [default: 0]
  total_healthcare_workers int [default: 0]
  last_patient_added_at timestamp [null]
  last_care_plan_updated_at timestamp [null]
  stats_period_start date [not null] // Start of the stats period
  stats_period_end date [not null] // End of the stats period
  created_at timestamp [default: now()]
  updated_at timestamp [default: now()]

  indexes {
    user_id
    (stats_period_start, stats_period_end)
    total_patients_managed
    active_patients
  }

  // Ensure no overlapping periods for same user
  checks {
    no_overlap: "NOT EXISTS (
      SELECT 1 FROM user_patient_management_stats s2 
      WHERE s2.user_id = user_id 
      AND s2.id != id
      AND (
        (stats_period_start BETWEEN s2.stats_period_start AND s2.stats_period_end)
        OR (stats_period_end BETWEEN s2.stats_period_start AND s2.stats_period_end)
      )
    )"
  }
}


// OTHER DEVICE OR PLATFORM DATA SECTION

// Healthcare worker devices
Table healthcare_worker_devices {
  id int [pk, increment]
  worker_id int [not null, ref: > healthcare_workers.id]
  device_id varchar(255) [not null]
  device_type varchar(50) [not null]
  device_name varchar(100)
  os varchar(50)
  os_version varchar(20)
  browser varchar(50)
  browser_version varchar(20)
  is_trusted boolean [default: false]
  is_active boolean [default: true]
  last_used timestamp
  last_ip varchar(45)
  last_location json [null]
  created_at timestamp [default: now()]
  deactivated_at timestamp [null]

  indexes {
    (worker_id, device_id) [unique]
    is_active
    device_type
  }
}